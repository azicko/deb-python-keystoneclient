Description: Work around upstream issue with memcached if running
             under Python 3.x.
             https://github.com/linsomniac/python-memcached/issues/70
Author: Corey Bryant <corey.bryant@canonical.com>
Forwarded: No
Last-Update: 2015-06-12

Index: python-keystoneclient/keystoneclient/tests/unit/test_auth_token_middleware.py
===================================================================
--- python-keystoneclient.orig/keystoneclient/tests/unit/test_auth_token_middleware.py
+++ python-keystoneclient/keystoneclient/tests/unit/test_auth_token_middleware.py
@@ -21,6 +21,7 @@ import stat
 import tempfile
 import time
 import uuid
+import sys
 
 import fixtures
 import iso8601
@@ -90,13 +91,22 @@ def memcached_available():
     global MEMCACHED_AVAILABLE
 
     if MEMCACHED_AVAILABLE is None:
-        try:
-            import memcache
-            c = memcache.Client(MEMCACHED_SERVERS)
-            c.set('ping', 'pong', time=1)
-            MEMCACHED_AVAILABLE = c.get('ping') == 'pong'
-        except ImportError:
-            MEMCACHED_AVAILABLE = False
+        if sys.version_info >= (3, 0):
+            try:
+                import memcache
+                c = memcache.Client(MEMCACHED_SERVERS)
+                c.set('ping', 'pong', time=1)
+                MEMCACHED_AVAILABLE = c.get('ping') == 'pong'
+            except (ImportError, TypeError):
+                MEMCACHED_AVAILABLE = False
+        else:
+            try:
+                import memcache
+                c = memcache.Client(MEMCACHED_SERVERS)
+                c.set('ping', 'pong', time=1)
+                MEMCACHED_AVAILABLE = c.get('ping') == 'pong'
+            except ImportError:
+                MEMCACHED_AVAILABLE = False
 
     return MEMCACHED_AVAILABLE
 
